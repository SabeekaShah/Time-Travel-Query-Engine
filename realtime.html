<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Stock Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="realscript.js" defer></script> <!-- Link to external JS file -->
</head>
<body class="flex flex-col items-center p-6 bg-gray-100">
    <h1 class="text-3xl font-bold mb-4">Real-Time Stock Data</h1>

    <!-- Stock Selection -->
    <div class="flex space-x-4 mb-4">
        <select id="company" class="p-2 border rounded">
            <option value="AAPL">Apple</option>
            <option value="005930.KQ">Samsung</option>
            <option value="GOOGL">Google</option>
            <option value="TSLA">Tesla</option>
            <option value="MSFT">Microsoft</option>
        </select>
        <button onclick="fetchStockData()" class="bg-blue-500 text-white px-4 py-2 rounded">Fetch Data</button>
    </div>

    <!-- Chart Canvas -->
    <canvas id="stockChart" class="w-full max-w-2xl bg-white p-4 rounded shadow"></canvas>

    <!-- Real-Time Stock Data Table -->
    <div class="mt-6 w-full max-w-4xl bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Stock Prices</h2>
        <table class="w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-200">
                    <th class="border px-4 py-2">Company</th>
                    <th class="border px-4 py-2">Price</th>
                    <th class="border px-4 py-2">Change</th>
                    <th class="border px-4 py-2">Time</th>
                </tr>
            </thead>
            <tbody id="stockTable">
                <!-- Real-time data will appear here -->
            </tbody>
        </table>
    </div>

    <script>
        let myStockChart;
        const API_KEY = "YUNIWJMM44KA6I1P";  // Replace with your actual API key

        async function fetchStockData() {
            const company = document.getElementById('company').value;
            const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${company}&interval=5min&apikey=${API_KEY}`);
            const data = await response.json();

            if (!data["Time Series (5min)"]) {
                alert("Error fetching data. Check API key or request limit.");
                return;
            }

            const timeSeries = data["Time Series (5min)"];
            const timestamps = Object.keys(timeSeries).reverse();
            const prices = timestamps.map(time => parseFloat(timeSeries[time]["1. open"]));

            updateChart(timestamps, prices, company);
            updateTable(company, prices, timestamps);
        }

        function updateChart(timestamps, prices, company) {
            const ctx = document.getElementById('stockChart').getContext('2d');

            if (myStockChart) myStockChart.destroy();

            myStockChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [{
                        label: `${company} Stock Price`,
                        data: prices,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Price: $${context.raw}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTable(company, prices, timestamps) {
            const stockTable = document.getElementById('stockTable');
            stockTable.innerHTML = `
                <tr class="hover:bg-gray-100">
                    <td class="border px-4 py-2">${company}</td>
                    <td class="border px-4 py-2">$${prices[prices.length - 1]}</td>
                    <td class="border px-4 py-2">$${(prices[prices.length - 1] - prices[prices.length - 2]).toFixed(2)}</td>
                    <td class="border px-4 py-2">${timestamps[timestamps.length - 1]}</td>
                </tr>
            `;
        }

        // Auto-refresh stock data every 30 seconds
        setInterval(fetchStockData, 30000);

    </script>
</body>
</html>
